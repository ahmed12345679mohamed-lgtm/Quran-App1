
import { DailyLog, Grade } from '../types';

// ุงูุชุญูุงุช ุงูุงูุชุชุงุญูุฉ
const GREETINGS = [
  "ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชูุ ุญูุงูู ุงููู ููู ุฃูุฑ ุงูุทุงูุจ ุงููุฌุชูุฏ {name} ๐น",
  "ุชุญูุฉ ุทูุจุฉ ูุจุงุฑูุฉุ ูุฑุณู ุฅูููู ุชูุฑูุฑ ุจุทููุง ุงููุฑุขูู {name} ููุฐุง ุงูููู ๐",
  "ุฃููุงู ุจูู ููู ุฃูุฑ ุงูุทุงูุจ {name}ุ ุฅูููู ุจุดุฑู ูุณุชูู ุงุจููู ุงูููู ูู ุงูุญููุฉ ๐",
  "ุงูุณูุงู ุนููููุ ูุถุน ุจูู ุฃูุฏููู ุญุตุงุฏ ุงูููู ูุงุจููุง ุงููุจุงุฑู {name} ๐"
];

// ุงูุฑุณุงุฆู ุจูุงุกู ุนูู ุงูุชูุฏูุฑ
const BODY_BY_GRADE = {
  [Grade.EXCELLENT]: [
    "ุจูุถู ุงูููุ ูุงู ุฃุฏุงุก {name} ุงูููู ูุจูุฑุงู ูููุชุงุฒุงู! ุชูุงูุฉ ูุชููุฉุ ูุญูุธ ุฑุงุณุฎุ ูุซูุฉ ุนุงููุฉ ุจุงูููุณ. ููุฏ ุฃุซูุฌ ุตุฏูุฑูุง ุจุชููุฒู.",
    "ูุง ุดุงุก ุงููู ูุง ููุฉ ุฅูุง ุจุงูููุ ูุณุชูู {name} ุงูููู ูู ุงูููุฉ. ุฏูุฉ ูู ุงูุฃุญูุงู ูุฌูุงู ูู ุงูุชูุงูุฉุ ููุฐุง ูุนูุณ ุฌูุฏูู ุงููุจุงุฑู ูู ุงููุชุงุจุนุฉ.",
    "ุฃุจุฏุน ุงูููู ูู ุชุณููุนูุ ููุงู ูุซุงูุงู ููุทุงูุจ ุงููุฌุชูุฏ. ุญูุธู ููุชุงุฒ ููุณุชุญู ูู ุนุจุงุฑุงุช ุงูุซูุงุก ูุงูุชูุฏูุฑ."
  ],
  [Grade.VERY_GOOD]: [
    "ุฃุฏุงุก {name} ุงูููู ุฌูุฏ ุฌุฏุงู ููุจุดุฑ ุจุงูุฎูุฑ. ุงูุชูุงูุฉ ุทูุจุฉ ูุงูุญูุธ ูุณุชูุฑุ ูุน ุจุนุถ ุงูุชูุจููุงุช ุงูุจุณูุทุฉ ุงูุชู ุณูุชุฌุงูุฒูุง ุจูููู ูู ุงููุฑุงุฌุนุฉ.",
    "ูุฏู ูุณุชูู ุทูุจุงู ุงููููุ ููุญู ูุฎูุฑูู ุจุชูุฏูู. ูุญุชุงุฌ ููุท ูุฒูุงุฏุฉ ุจุณูุทุฉ ูู ุงูุชูุฑุงุฑ ููุตู ุฅูู ุงูุงูุชูุงุฒ ูู ุงููุฑุฉ ุงููุงุฏูุฉ ุจุฅุฐู ุงููู.",
    "ุฌูุฏ ูุงุถุญ ููุณุชูู ูุชูุฏูุ ุจุงุฑู ุงููู ูู ููุชู. ูุชุทูุน ููู ูููุฒูุฏ ูู ุงูุชุฑููุฒ ููุตุจุญ ุญูุธู ูุชููุงู ุชูุงูุงู."
  ],
  [Grade.GOOD]: [
    "ูุณุชูู {name} ุงูููู ุฌูุฏุ ููููู ููุชูู ูุฏุฑุงุช ุฃุนูู ูู ุฐูู. ุงูุญูุธ ูุญุชุงุฌ ููุฒูุฏ ูู ุงูุชุซุจูุช ูุงููุฑุงุฌุนุฉ ูู ุงูููุฒู.",
    "ุฃุฏุงุคู ููุจููุ ูููููุง ูุนูุฏู ุฏุงุฆูุงู ูู ุงููุฑุงุชุจ ุงูุฃููู. ูุฑุฌู ุชูุซูู ุงููุฑุงุฌุนุฉ ุงูููููุฉ ููุนูุฏ ููุณุชูุงู ุงููุนููุฏ.",
    "ุจุฐู ุฌูุฏุงู ุทูุจุงูุ ููู ุงูุชุณููุน ุชุฎููู ุจุนุถ ุงูุชุฑุฏุฏ. ููุตู ุจุชุฎุตูุต ููุช ุฃูุจุฑ ููุชูุฑุงุฑ ูุจู ุงูุญุตุฉ ุงููุงุฏูุฉ."
  ],
  [Grade.ACCEPTABLE]: [
    "ูุณุชูู ุงูููู ูุญุชุงุฌ ููููุฉ ูุงูุชูุงู ุฃูุจุฑ. ุงูุญูุธ ูุงู ุถุนููุงู ุจุนุถ ุงูุดูุกุ ููุฎุดู ุนููู ูู ุงูุชููุช ุฅุฐุง ูู ูุชู ุชุฏุงุฑูู.",
    "ูููุช ุงูุชุจุงููู ุฃู {name} ูุงุฌู ุตุนูุจุฉ ูู ุงูุชุณููุน ุงูููู. ูุฑุฌู ูููู ูุชุงุจุนุชู ูู ุงูููุฒู ูุชุนููุถ ูุง ูุงุช.",
    "ุงูุฃุฏุงุก ุงูููู ูุงู ููุจููุงู ุจุตุนูุจุฉ. ุงููุฑุขู ุนุฒูุฒ ููุญุชุงุฌ ูุชุนุงูุฏุ ูุฑุฌู ุญุซู ุนูู ุงูุงุฌุชูุงุฏ ุฃูุซุฑ."
  ],
  [Grade.NEEDS_WORK]: [
    "ููุฃุณูุ ุงูุญูุธ ุงูููู ูู ููู ุฌุงูุฒุงู ููุญุชุงุฌ ูุฅุนุงุฏุฉ. ูุซู ุจูุฏุฑุฉ {name} ุนูู ุงูุชุนููุถุ ูููู ูุญุชุงุฌ ูุฏุนููู ููุชุงุจุนุชูู ุงูุฌุงุฏุฉ.",
    "ูู ูุชููู ูู ุงูุชุณููุน ุงูููู ุจุดูู ุตุญูุญ. ูุฑุฌู ุงูุชุนุงูู ูุนูุง ูุชูุซูู ุงููุฑุงุฌุนุฉ ูู ุงูุจูุช ูุถูุงู ุนุฏู ุชุฃุฎุฑู ุนู ุฒููุงุฆู."
  ]
};

// ุงูุฃุฏุนูุฉ ุงูุฎุงุชูุฉ ูููุงูุฏูู ูุงูุทุงูุจ
const CLOSINGS = [
  "ูุณุฃู ุงููู ุฃู ููุฑ ุฃุนูููู ุจูุ ูุฃู ูุฌุนูู ูู ุญูุธุฉ ูุชุงุจู ุงูุนุงูููู ุจูุ ูุฌุฒุงูู ุงููู ุฎูุฑุงู ุนูู ุญุณู ูุชุงุจุนุชูู. ๐คฒ",
  "ุจุงุฑู ุงููู ูููู ููู ุฐุฑูุชููุ ูุฌุนู ุงููุฑุขู ุดููุนุงู ููู ููู ููู ุงูููุงูุฉ. ุดูุฑุงู ูุงูุชูุงููู. โจ",
  "ุงูููู ุฃูุจุชู ูุจุงุชุงู ุญุณูุงู ูุงุฌุนูู ูุฑุฉ ุนูู ููุงูุฏูู. ุดูุฑ ุงููู ุณุนููู ููุชุจ ุฃุฌุฑูู. ๐ท",
  "ุฒุงุฏูู ุงููู ุญุฑุตุงู ูุชููููุงูุ ูุฃูุจุณูู ุจู ุชุงุฌ ุงูููุงุฑ ููู ุงูููุงูุฉ. ุฏูุชู ูู ุญูุธ ุงููู. ๐"
];

const DEFAULT_BODIES = [
    "ูุณุฃู ุงููู ุฃู ูุฌุนูู ูู ุฃูู ุงููุฑุขู. ูุฑุฌู ุงูุงุณุชูุฑุงุฑ ูู ุงููุฑุงุฌุนุฉ ูุงูุงูุชูุงู ุจุงููุฑุฏ ุงููููู.",
    "ุจุงุฑู ุงููู ูู ุงูุฌููุฏ ุงููุจุฐููุฉุ ููุชุธุฑ ุงููุฒูุฏ ูู ุงูุชูุฏู ูุงูุชุฑููุฒ ูู ุงูุญุตุต ุงููุงุฏูุฉ.",
];

export const generateEncouragement = async (studentName: string, log: DailyLog): Promise<string> => {
  // 1. ุงุฎุชูุงุฑ ุงูุชุญูุฉ
  const greetingTemplate = GREETINGS[Math.floor(Math.random() * GREETINGS.length)];
  const greeting = greetingTemplate.replace("{name}", studentName);

  // 2. ุชุญุฏูุฏ ุงูุชูุฏูุฑ ูุงุฎุชูุงุฑ ูุต ุงูุฑุณุงูุฉ
  let grade = log.jadeed?.grade;
  
  // If no main grade (e.g. MULTI with undefined top-level), try to find an average or first grade from multiSurahs
  if (!grade && log.jadeed?.type === 'MULTI' && log.jadeed.multiSurahs && log.jadeed.multiSurahs.length > 0) {
      grade = log.jadeed.multiSurahs[0].grade;
  }

  if ((!grade || grade === undefined) && log.murajaah && log.murajaah.length > 0) {
      grade = log.murajaah[0].grade;
      if (!grade && log.murajaah[0].type === 'MULTI' && log.murajaah[0].multiSurahs) {
          grade = log.murajaah[0].multiSurahs[0]?.grade;
      }
  }

  let bodyTemplate = "";
  if (!grade) {
      bodyTemplate = DEFAULT_BODIES[Math.floor(Math.random() * DEFAULT_BODIES.length)];
  } else {
      const bodies = BODY_BY_GRADE[grade] || DEFAULT_BODIES;
      bodyTemplate = bodies[Math.floor(Math.random() * bodies.length)];
  }
  const body = bodyTemplate.replace("{name}", studentName);

  // 3. ุงุฎุชูุงุฑ ุงูุฎุงุชูุฉ ูุงูุฏุนุงุก
  const closing = CLOSINGS[Math.floor(Math.random() * CLOSINGS.length)];

  // ุชุฌููุน ุงูุฑุณุงูุฉ
  return `${greeting}\n\n${body}\n\n${closing}`;
};
